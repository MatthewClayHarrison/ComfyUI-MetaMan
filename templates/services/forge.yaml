# Forge Output Template
# Defines how to format metadata for Forge compatibility
# Forge is based on A1111 with extensions

service_name: "forge"
output_format: "parameters_text"
description: "Template for generating Forge-compatible metadata (extends A1111 format)"

# Base template (Forge extends A1111)
base_template: "automatic1111"
extensions:
  - "advanced_sampling"
  - "enhanced_controlnet"
  - "forge_specific_features"

# Format template (same as A1111)
format_template: |
  {prompt}
  {negative_prompt_line}
  {parameters_line}

# Enhanced parameter order for Forge
parameter_order:
  - "steps"
  - "sampler"
  - "scheduler"  # Forge supports explicit scheduler
  - "cfg_scale"
  - "seed"
  - "size"
  - "model_hash"
  - "model"
  - "clip_skip"
  - "denoising_strength"
  - "eta"
  - "sgm_noise_multiplier"  # Forge-specific
  - "hires_fix"
  - "hires_upscaler"
  - "hires_steps"
  - "hires_denoising"

# Forge-specific parameter formatting
forge_parameters:
  scheduler:
    format: "Schedule type: {value}"
    type: "string"
    options: ["Automatic", "Uniform", "Karras", "Exponential", "Polyexponential"]
    condition: "value is not None and value != 'Automatic'"
    
  sgm_noise_multiplier:
    format: "SGM noise multiplier: {value}"
    type: "float"
    precision: 2
    condition: "value is not None and value != 1.0"
    
  # Enhanced sampler support
  sampler_extensions:
    "DPM++ 2M Turbo": "DPM++ 2M Turbo"
    "DPM++ 2M SDE Turbo": "DPM++ 2M SDE Turbo"
    "Restart": "Restart"

# Forge ControlNet extensions
controlnet_extensions:
  enabled: true
  support_multiple: true
  max_units: 3
  
  parameters:
    - "ControlNet {unit}: \"{model}\""
    - "ControlNet {unit} Module: {module}"
    - "ControlNet {unit} Weight: {weight}"
    - "ControlNet {unit} Guidance Start: {guidance_start}"
    - "ControlNet {unit} Guidance End: {guidance_end}"

# Forge-specific features
forge_features:
  attention_optimization:
    format: "Attention optimization: {value}"
    options: ["none", "sdp", "xformers", "flash-attention"]
    default: "sdp"
    
  unet_storage_dtype:
    format: "Forge UNET storage dtype: {value}"
    options: ["automatic", "float16", "float32", "bfloat16"]
    default: "automatic"
    
  gpu_memory_fraction:
    format: "GPU memory fraction: {value}"
    type: "float"
    range: [0.1, 1.0]
    precision: 2

# PNG chunk configuration
png_chunk:
  chunk_name: "parameters"
  encoding: "latin-1"
  fallback_encoding: "utf-8"
  compress: false
  
  # Optional Forge-specific chunk
  forge_chunk:
    chunk_name: "forge"
    encoding: "utf-8"
    format: "json"
    compress: true

# Validation rules
validation:
  required_fields: ["prompt"]
  forge_compatibility: true
  scheduler_validation: true
